<!DOCTYPE HTML>
<html>
  <head>
    <!--<link type="text/css" rel="stylesheet" media="all" href="dist/libs.css">-->
    <!--<link type="text/css" rel="stylesheet" media="all" href="dist/styles.css">-->
    <title>Quick Staffing tool</title>
    <script src="js/libs/angular.min.js"></script>
    <script src="js/libs/kinetic.min.js"></script>

  </head>
  <body ng-app="QuickStaffing" ng-controller="IndexController as ctrl">
    <h1>Quick Staffing tool</h1>

    <div style="height: 102px; padding-left: 100px;">
      <div ng-repeat="position in ctrl.positions" ng-click="ctrl.matchCandidates(position, $event, $index)"
          style="display: inline-block; border: solid 1px; width: 100px; height: 100px;"></div>
    </div>
    <!--<canvas id="myCanvas" width="1012" height="350" style="border: solid 1px; margin-left: 100px;"></canvas>-->
    <div id="container" style="border: solid 0px; margin-left: 100px; width: 1012px;"></div>
    <div style="height: 102px; padding-left: 100px; margin-top: -15px;">
      <div ng-repeat="position in ctrl.candidates" ng-click="ctrl.selectCandidate($index)"
           style="display: inline-block; border: solid 1px; width: 100px; height: 100px;"></div>
    </div>


    <script>
      var IndexController = function($scope) {
        this.candidates = [{
          fullName: 'Dzmitry Ulasau'
        }, {
          fullName: 'Dzmitry Ulasau'
        }, {
          fullName: 'Dzmitry Ulasau'
        }, {
          fullName: 'Dzmitry Ulasau'
        }, {
          fullName: 'Dzmitry Ulasau'
        }, {
          fullName: 'Dzmitry Ulasau'
        }, {
          fullName: 'Dzmitry Ulasau'
        },{
          fullName: 'Dzmitry Ulasau'
        }, {
          fullName: 'Dzmitry Ulasau'
        }, {
          fullName: 'Dzmitry Ulasau'
        }];

        this.positions = [{
          projectName: 'Signpost',
          customer: 'Google',
          id: 1111
        },{
          projectName: 'Signpost',
          customer: 'Google',
          id: 1111
        }, {
          projectName: 'Signpost',
          customer: 'Google',
          id: 1111
        }, {
          projectName: 'Signpost',
          customer: 'Google',
          id: 1111
        }, {
          projectName: 'Signpost',
          customer: 'Google',
          id: 1111
        }, {
          projectName: 'Signpost',
          customer: 'Google',
          id: 1111
        }, {
          projectName: 'Signpost',
          customer: 'Google',
          id: 1111
        }, {
          projectName: 'Signpost',
          customer: 'Google',
          id: 1111
        }, {
          projectName: 'Signpost',
          customer: 'Google',
          id: 1111
        }, {
          projectName: 'Signpost',
          customer: 'Google',
          id: 1111
        }];
      };

      var driveToIndex = 2;
      var stage = new Kinetic.Stage({
        container: 'container',
        width: 1012,
        height: 360
      });

      function getRandomInt(min, max) {
        return Math.floor(Math.random() * (max - min + 1)) + min;
      }

      function getRandom(min, max) {
        return Math.random() * (max - min) + min;
      }


      var drawLine = function(x1, x2) {
        var left = false;
        var y1 = 0;
        var y2 = 350;

        var a =  (y2 - y1) / (x2 - x1);
        var b = y2 - a * x2;

        var step = 60;
        var points = [x1, y1];

        if (left) {
          points.push(calcX(a, b, getRandomInt(60, 100)) + getRandomInt(80, 160));
        } else {
          points.push(calcX(a, b, getRandomInt(60, 100)) - getRandomInt(80, 160));
        }
        points.push(getRandomInt(120, 160));

        if (left) {
          points.push(calcX(a, b, getRandomInt(180, 220)) - getRandomInt(80, 160));
        } else {
          points.push(calcX(a, b, getRandomInt(180, 220)) + getRandomInt(80, 160));
        }
        points.push(getRandomInt(180, 220));

        points.push(x2); points.push(y2);

        var layer = new Kinetic.Layer();

        var blueSpline = new Kinetic.Line({
          points: points,
          stroke: 'black',
          strokeWidth: getRandom(0.1, 3),
          lineCap: 'round',
          tension: 0.5
        });

        layer.add(blueSpline);

        stage.add(layer);
      };

      var calcY = function(a, b, x) {
        return a * x + b;
      };

      var calcX = function(a, b, y) {
        console.log(a, b, y);
        return (y - b) / a;
      };

      IndexController.prototype.matchCandidates = function(position, $event, $index) {
        var elementWidth = $event.srcElement.clientWidth;
//        var x1 = ($index * (elementWidth + 2) + elementWidth / 2);
//        var x2 = (driveToIndex * (elementWidth + 2) + elementWidth / 2);

        var x2 = ($index * (elementWidth + 2) + elementWidth / 2);
        var x1 = (driveToIndex * (elementWidth + 2) + elementWidth / 2);

        drawLine(x1, x2);
      };

      IndexController.prototype.selectCandidate = function($index) {
        driveToIndex = $index;
      };

      angular
          .module('QuickStaffing', [])
          .controller('IndexController', IndexController);

    </script>


    <!--<script src="dist/libs.js"></script>-->
    <!--<script src="dist/scripts.js"></script>-->
  </body>
</html>
